<h2>イベント一覧</h2>

<% @events.each do |event| %>

  <% if event.schedule.to_date > @index_date %>
    <% @index_date = event.schedule.to_date %>
    <p><%= l @index_date, format: :index %></p>
  <% end %>

  <table>
    <tr>
      <th>イベント名：</th>
      <td><%= link_to "#{event.name}", event_path(event) %></td>
    </tr>
    <tr>
      <th>グループ名：</th>
      <td><%= event.group.name %></td>
    </tr>
    <tr>
      <th>日時：</th>
      <td><%= l event.schedule, format: :long %></td>
    </tr>
    <tr>
      <th>場所：</th>
      <td><%= event.address %></td>
    </tr>
  </table>

  <h3>参加可能な言語</h3>

  <% @languages_select_list = [] %>

  <% event.event_languages.each do |event_language| %>
    <p><%= event_language.language.ja_name %>：<%= event_language.max %>人　※あと<%= rest = event_language.max - event.participants.where(language_id: event_language.language_id).count %>人参加できます</p>

    <% @languages_select_list.push([event_language.language.ja_name,event_language.language_id]) if rest != 0 %>

  <% end %>
  
  <% if event.permission? %>
    <p>※このイベントはオーガナイザーの許可のあとで参加が確定します</p>
  <% end %>

  <%= form_with(url: participants_path, local: true) do |form| %>
    <%= form.hidden_field :event_id, value: event.id %>
    <%= form.label :language_id %>
    <%= form.select :language_id, @languages_select_list %>

    <%= form.submit %>
  <% end %>

  <br>
<% end %>
